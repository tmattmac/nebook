{% extends 'base.html' %}

{% macro author_list(authors) %}
  <ul>
  {% for author in authors %}
    <li class="author"><a href="{{url_for('index', author=author.id)}}"">{{author.name}}</a></li>
  {% endfor %}
  </ul>
{% endmacro %}

{% block title %}Hello World!{% endblock %}

{% block content %}
{{current_user.username}}<br>
{{current_user.email}}

{% if not current_user.gdrive_permission_granted %}

<p>You will need to authorize access to Google Drive to manage your ebooks.<p>
<a href="{{url_for('gdrive_authorize')}}" id="gdrive_authorize" class="btn btn-primary">Authorize</a>



{% else %}
  <form method="POST" action="/upload" enctype="multipart/form-data">
    <input type="file" name="file" class="form-control">
    <button class="btn btn-primary">Submit</button>
  </form>
  <table class="table">
    <thead>
      <tr>
        <th scope="col">Title</th>
        <th scope="col">Authors</th>
        <th scope="col">Publisher</th>
        <th scope="col">Read Link</th>
      </tr>
    </thead>
    <tbody>
      {% for book in books %}
        <tr>
          <td>{{book.title}}</td>
          <td>{{author_list(book.authors)}}</td>
          <td>{{book.publisher}}</td>
          <td><a href="{{url_for('reader.reader_view', id=book.gdrive_id)}}">Read</a></td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  {{ file }}
{% endif %}
{% endblock %}